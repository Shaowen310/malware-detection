## import
import numpy as np
import pandas as pd
from data_header_extrac import extract_header
from keras.models import load_model
from sklearn.metrics import roc_auc_score

## arguments
data_file = "./../Data/test/test.csv"
pred = "./pred.csv"
model_1_save = "./model1.h5"
model_2_save = "./model2.h5"
model_3_save = "./model3.h5"

## data preprocess
print('\ndata processing started ...')

testX, skip_idx = extract_header(data_file, False)

print ("Shape of test data(m):\n", testX.shape)

## Load models
print('\nloading models ...')
model1 = load_model(model_1_save)
model2 = load_model(model_2_save)
model3 = load_model(model_3_save)

print('\nMaking predictions ...')
predictions = np.zeros((testX.shape[0], 3))
predictions[:, 0] = model1.predict(testX).reshape(testX.shape[0])
predictions[:, 1] = model2.predict(testX).reshape(testX.shape[0])
predictions[:, 2] = model3.predict(testX).reshape(testX.shape[0])
predict_df = pd.DataFrame(predictions).mean(axis=1)

print('\nWriting outputs ...')
predict_df.to_csv(pred, index=True, index_label="sample_id", header=["malware"])
